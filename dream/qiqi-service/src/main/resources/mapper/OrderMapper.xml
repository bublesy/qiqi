<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qiqi.order.mapper.OrderMapper">
    <select id="getList" resultType="com.qiqi.admin.purchase.model.PurchaseOrderVO">
SELECT o.*,p.documents_no,p.purchaseQuantity,p.cost_price,p.amount,p.id as pid,p.end_product_pos,p.position,
p.supplier_id,p.billingDate as pBilling,p.return_num,p.discount,p.discount_amount,p.profit  from  orders o left join purchase_order p on o.no = p.task_number
        where o.is_deleted =0
        <if test=" customerName != null and customerName != '' ">
            and  o.name like concat('%', #{customerName} , '%')
        </if>
        <if test="quantityOverdue == '已过期'  ">
            and  o.delivery_date &lt;  #{date}
        </if>
        <if test="quantityOverdue == '未过期'  ">
            and  o.delivery_date &gt;= #{date}
        </if>
        <if test="time != null and time != ''  ">
            and  o.created_time like concat('%', #{time} , '%')
        </if>
    </select>
    <select id="getAllOrder" resultType="com.qiqi.order.entity.OrderDO">
        SELECT name,SUM(`money`) as money, DATE_FORMAT(`delivery_date`,"%Y-%m") as myDate ,customer_id
        FROM `orders`
        WHERE `is_deleted`=0
        and DATE_FORMAT(`delivery_date`,"%Y-%m") = #{deliveryDate}
        and customer_id = #{customerId}
        GROUP BY customer_id,DATE_FORMAT(`delivery_date`,"%Y%m") limit #{page} #{count}
    </select>
    <select id="getTotal" resultType="com.qiqi.order.entity.OrderDO">
        select DATE_FORMAT(`delivery_date`,"%Y-%m") as myDate,sum(money)
        from orders o
        where o.is_deleted=0
        and DATE_FORMAT(`delivery_date`,"%Y-%m") = #{deliveryDate}
        GROUP BY DATE_FORMAT(`delivery_date`,"%Y-%m")
    </select>


</mapper>
